<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
  <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/game-guides-e45be.appspot.com/o/Images%2FDo%20not%20delete%2Fpassword.jpeg?alt=media&token=ac12bec4-47bf-4995-ad4c-cb488b65cab6">
  <link rel="icon" href= style="width: 180px;height:55px; margin-top: 3px;"></a>

  <!-- for the social media icon -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">


<style>
html, body {
  height: 100%;
  overflow: hidden;
  margin: 0;
}
#content {
  height: 100%;
}
#left {
  float: left;
  width: 40%;
  background: white;
  height: 100%;
  overflow-y: auto;

  
}
#right {
  float: left;
  width: 60%;
  background: #FAE5D3  ;
  height: 90%;
  overflow-y: auto;
}

#sendMessageDiv{
  width:60%;
  height:10%;
  position: absolute;
  bottom: 0;
 padding-bottom:10px;
 padding-left:15px;
}
#receiverName{
  width:60%;
  height:10%;
  position: absolute;
  top: 50;
 padding-bottom:10px;
 padding-left:15px;
}
#boxGameDiv{
  width:60%;
  position: absolute;
}

i.icon-blue {
    color: white;
}
nav {
       height: 50px;
        line-height: 50px;
    }

</style>
</head>
<body>    
        <!-- NAVBAR --> 
<div class="navbar-fixed ">
    <nav class="nav-wrapper blue">
      <div class="container">
        <a href="#" class="sidenav-trigger" data-target="mobile-links1">
          <i class="material-icons">menu</i>
        </a>
        <ul class="right hide-on-med-and-down">
          <li class="logged-in" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-account">Account Info</a>
          </li>
          <li class="logged-in" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-logout" >Logout</a>
          </li>
          <li class="logged-out" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-login">Login</a>
          </li>
          <li class="logged-out" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-signup">Sign up</a>
          </li>
          
        </ul>
      </div>
    </nav>
  </div>

  <ul class="sidenav sidenav-close" id="mobile-links1">
         <li class="logged-in" style="display:none;">
           <div class="user-view">
             <div class="background">
                <img src="https://images.pexels.com/photos/531880/pexels-photo-531880.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500">
             </div>
             <a href="#user"><img class="circle" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/220px-User_icon_2.svg.png"></a>
             <a href="#name"><span class="white-text name" ></span></a>
             <a href="#email"><span class="white-text email"></span></a>
          </div>

          <li class="logged-out" style="display:none;">
           <div class="user-view">
             <div class="background">
                <img src="https://images.pexels.com/photos/531880/pexels-photo-531880.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500">
             </div>
             <a href="#user"><img class="circle" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/220px-User_icon_2.svg.png"></a>
             <a href="#"><span class="white-text name" >Login to view the user info.</span> </a>
          </div>

            <!--<a href="#" class="modal-trigger" data-target="modal-account">Account Info</a>   -->
         </li>
          <li class="logged-in" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-logout" ><i class="material-icons">exit_to_app</i>Logout</a>
          </li>
          <li class="logged-out" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-login">Login</a>
          </li>
          <li class="logged-out" style="display:none;">
            <a href="#" class="modal-trigger" data-target="modal-signup">Sign up</a>
          </li>
    
  </ul>

 <!-- SIGN UP MODAL -->
  <div id="modal-signup" class="modal">
    <div class="modal-content">
      <h4>Sign up</h4><br />
      <form id="signup-form">
        <div class="input-field">
          <input type="text" id="signup-bio" required />
          <label for="signup-bio">Name</label>
        </div>
        <div class="input-field">
          <input type="email" id="signup-email" required />
          <label for="signup-email">Email address</label>
        </div>
        <div class="input-field">
          <input type="password" id="signup-password" required />
          <label for="signup-password">Choose password</label>
        </div>
        <button class="btn yellow darken-2 z-depth-0">Sign up</button>
        <p class="error pink-text center-align"></p>
      </form>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div id="modal-login" class="modal">
    <div class="modal-content">
      <h4>Login</h4><br />
      <form id="login-form">
        <div class="input-field">
          <input type="email" id="login-email" required />
          <label for="login-email">Email address</label>
        </div>
        <div class="input-field">
          <input type="password" id="login-password" required />
          <label for="login-password">Your password</label>
        </div>
        <button class="btn yellow darken-2 z-depth-0">Login</button>
       
        <!--<a href='#' onclick="forgotPass();">Forgot Password?</a>-->
        <p class="error pink-text center-align"></p>
      </form>
      <a href="#" class="modal-trigger" data-target="modal-resetPassword" id="forgotLink">Forgot password?</a>
    </div>
  </div>



  <!-- PASSWORD RESET MODAL -->
  <div id="modal-resetPassword" class="modal">
    <div class="modal-content">
      <h4>Reset Password</h4><br />
      <form id="reset-password">
        <div class="input-field">
          <input type="email" id="login-email" required />
          <label for="login-email">Email address</label>
        </div>
        <button class="btn yellow darken-2 z-depth-0" >Reset</button>
        <p class="error pink-text center-align"></p>
      </form>
    </div>
  </div>


  <!-- ACCOUNT MODAL -->
  <div id="modal-account" class="modal">
    <div class="modal-content center-align">
      <h4>Account details</h4><br />
           <div class="user-view">
             <a href="#user"><img class="circle" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/User_icon_2.svg/220px-User_icon_2.svg.png"></a>
          </div>
            <!--<a href="#" class="modal-trigger" data-target="modal-account">Account Info</a>   -->
        <div class="account-details"></div> 
    </div>
  </div>

  <!--LOGOUT CONFIRMATION BOX-->
  <div id="modal-logout" class="modal">
    <div class="modal-content">
      <h4>Logout</h4>
      <p>Do you want to logout?</p>
    </div>
    <div class="modal-footer">
            <a href="#" onclick="logouts();" class="modal-action modal-close waves-effect waves-green btn-flat ">Yes</a>
            <a href="#" class="modal-action modal-close waves-effect waves-red btn-flat ">No</a>
   </div>
  </div>
 
 
    <div id="left"> 
        <header style="height:60px;background:#E8E6E6;border:1px solid #D1D0D0;">
        <b><p class="logged-out" style="font-size:100%;color:red;">User is not logged-in.</p></b>
         <b><p class="logged-in" id="userInformation1" style="font-size:80%;"></p></b>
         <p class="logged-in" id="userInformation2" style="font-size:60%;"></p>
        </header>
        <div class="logged-in" id="friendList"><h5 style="background:#D0ECE7;word-wrap:break-word;">All Users</h5></div>
     </div>

    <div id="right">
      <div  id="receiverName" style="height:60px;background:#E8E6E6;border:1px solid #D1D0D0;margin-bottom:15px;">
         <p class="logged-in" id="rName"></p>
         <p class="logged-in" id="rEmail"></p>
      </div>
      <div  style="height:60px;background:#FAE5D3;"></div>
      <div id="boxGameDiv" style="background:#FAE5D3;border-bottom:2px solid #00C39F;display:none;padding-left:15%;">
        <input type="text" id="1" onKeyUp="storeInDatabase('1','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;">
        <input type="text" id="2" onKeyUp="storeInDatabase('2','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;"> 
        <input type="text" id="3" onKeyUp="storeInDatabase('3','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;"><br>
        <input type="text" id="4" onKeyUp="storeInDatabase('4','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;">
        <input type="text" id="5" onKeyUp="storeInDatabase('5','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;">
        <input type="text" id="6" onKeyUp="storeInDatabase('6','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;"><br>
        <input type="text" id="7" onKeyUp="storeInDatabase('7','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;">
        <input type="text" id="8" onKeyUp="storeInDatabase('8','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;">
        <input type="text" id="9" onKeyUp="storeInDatabase('9','+');" style="width:20px;border:4px solid black;border-radius:5px;margin-right:3px;padding-left:10px;height:20px;font-weight:bold;"><br>
        <p id="whoseTurn" style="padding-left:15px;">Turn : </p>
        <button type="button" class="btn" onclick="storeInDatabase('','-');" style="margin-left:20px;margin-bottom:5px;">Clear all</button>
      </div>
      <div  style="height:230px;background:#FAE5D3;"></div>
      
     <div class="logged-in" id="showChat"></div>
      <div style="height:70px;background:#FAE5D3;"></div>
      <div class="logged-in" style="background:#F4F2F2;" id="sendMessageDiv">
     
        <input type="text" id="userText" placeholder="Type a message" style="width:75%;border-radius:25px;border:none;background:white;padding-left:15px;">
        <button id="send" onclick="addDataToDatabase();" type="submit" style="width:5%;margin-top:10px;border:none;background:#F4F2F2 ;" disabled><i style="background:#28B463;border-radius:50%;font-size:25px;" class="material-icons icon-blue">send</i></button>
   
      
     </div>
   </div>

   <script>
   function storeInDatabase(id, key){
       var emailSender = window.userIs.email.replace(/[^a-zA-Z0-9]/g, "");
       var emailReceiver = window.toWhom.replace(/[^a-zA-Z0-9]/g, "");

       var compare =  emailSender.localeCompare(emailReceiver);

       var time = new Date().toString().slice(16,21);
       if(compare == -1){
         dbName1 = emailSender;
         dbName2 = emailSender+'-'+emailReceiver;
       }
       else{
         dbName1 = emailReceiver;
         dbName2 = emailReceiver+'-'+emailSender;
       }
    if(key =="+"){
      var value = document.getElementById(id).value;
        
       //var refGame = database.ref('TikTokToi/'+dbName1+'/'+dbName2);
       var data2 = {
              From : window.userIs.email,
              Id : id,
              Value : value.toUpperCase()
           }
          if(document.getElementById('whoseTurn').innerHTML == "Turn : You"){ 
            if(value =='x' || value =='X' || value =='o' || value =='O'){
              database.ref('TikTokToi/'+dbName1+'/'+dbName2+'/'+id).update(data2);
              document.getElementById(id).disabled = true;
            }
            else{
              M.toast({html:"Enter the correct option."});
              document.getElementById(id).value = '';
            }
              
          }
          else{
            M.toast({html:'It is not your turn.'});
            document.getElementById(id).value = '';
            //document.getElementById(id).disabled = false;
          }
           
       //refGame.push(data2);
     }
     if(key == "-"){
       database.ref('TikTokToi/'+dbName1+'/'+dbName2).remove();
       for(var i=1;i<10;i++){
        document.getElementById(i.toString()).value='';
        document.getElementById(i.toString()).disabled = false;
        if(dbName1 == window.userIs.email.replace(/[^a-zA-Z0-9]/g, "")){
          document.getElementById('whoseTurn').innerHTML = "Turn : You";
        }
        else{
          document.getElementById('whoseTurn').innerHTML = "Turn : Another Player";
        }
      }
     }
     callShowBox(dbName1,dbName2);
     
   }

   
   function callShowBox(n1, n2){
    var dbName1 = n1;
    var dbName2 = n2;
     database.ref('TikTokToi/'+dbName1+'/'+dbName2).on('value', snap =>{
       //console.log(snap.val());
       var c=0;
       snap.forEach(function(childSnapshot){
         c++;
          var id = childSnapshot.val().Id;
          var value = childSnapshot.val().Value;
          console.log(id);
          if(c%2 ==0){
            if(dbName1 == window.userIs.email.replace(/[^a-zA-Z0-9]/g, "")){
                document.getElementById('whoseTurn').innerHTML = "Turn : You";
            }
            else{
              document.getElementById('whoseTurn').innerHTML = "Turn : Another Player";
            }
          }
          else{
            if(dbName1 != window.userIs.email.replace(/[^a-zA-Z0-9]/g, "")){
                document.getElementById('whoseTurn').innerHTML = "Turn : You";
            }
            else{
              document.getElementById('whoseTurn').innerHTML = "Turn : Another Player";
            }
          }
          
          document.getElementById(id).value = value;
          document.getElementById(id).disabled = true;
          if(value == "X"){
             document.getElementById(id).style.color = "red";
          }
          else{
            document.getElementById(id).style.color = "green";
          }
          
        });
        
        var val1 = document.getElementById("1").value;
        var val2 = document.getElementById("2").value;
        var val3 = document.getElementById("3").value;
        var val4 = document.getElementById("4").value;
        var val5 = document.getElementById("5").value;
        var val6 = document.getElementById("6").value;
        var val7 = document.getElementById("7").value;
        var val8 = document.getElementById("8").value;
        var val9 = document.getElementById("9").value;
        if(val1!='' && val1==val2 && val2==val3){
          document.getElementById("whoseTurn").innerHTML = val1+" won the match.";
        }
        else if(val4!='' && val4==val5 && val5==val6){
          document.getElementById("whoseTurn").innerHTML = val4+" won the match.";
        }
        else if(val7!='' && val7==val8 && val8==val9){
          document.getElementById("whoseTurn").innerHTML = val7+" won the match.";
        }
        else if(val1!='' && val1==val4 && val4==val7){
          document.getElementById("whoseTurn").innerHTML = val1+" won the match.";
        }
        else if(val2!='' && val2==val5 && val5==val8){
          document.getElementById("whoseTurn").innerHTML = val2+" won the match.";
        }
        else if(val3!='' && val3==val6 && val6==val9){
          document.getElementById("whoseTurn").innerHTML = val3+" won the match.";
        }
        else if(val1!='' && val1==val5 && val5==val9){
          document.getElementById("whoseTurn").innerHTML = val1+" won the match.";
        }
        else if(val3!='' && val3==val5 && val5==val7){
          document.getElementById("whoseTurn").innerHTML = val3+" won the match.";
        }else if(val1=='' && val2=='' && val3=='' && val4=='' && val5=='' && val6=='' && val7=='' && val8=='' && val9==''){
          //document.getElementById("whoseTurn").innerHTML = "Turn : ";
        }
        else if(val1!='' && val2!='' && val3!='' && val4!='' && val5!='' && val6!='' && val7!='' && val8!='' && val9!=''){
           document.getElementById("whoseTurn").innerHTML = "Match is draw.";
        }
        else{

        }
     });
     console.log(document.getElementById('whoseTurn').innerHTML);
    
     
  }
   //var objDiv = document.getElementById("right");
    //objDiv.scrollTop = objDiv.scrollHeight;
    window.count =0;
   window.toWhom ="";
     function addDataToDatabase(){
       var emailSender = window.userIs.email.replace(/[^a-zA-Z0-9]/g, "");
       var emailReceiver = window.toWhom.replace(/[^a-zA-Z0-9]/g, "");

       var compare =  emailSender.localeCompare(emailReceiver);

       var time = new Date().toString().slice(16,21);
       if(compare == -1){
         dbName1 = emailSender;
         dbName2 = emailSender+'-'+emailReceiver;
       }
       else{
         dbName1 = emailReceiver;
         dbName2 = emailReceiver+'-'+emailSender;
       }

       var reff = database.ref('LetsChat/'+dbName1+'/'+dbName2);
       var data = document.getElementById('userText').value;
       if(data.trim().length >0){
            var data1 = {
              From : window.userIs.email,
              To : window.toWhom,
              Text : data,
              Time : time
           }
       reff.push(data1);   // reff.set(data1); will override the data
       document.getElementById('userText').value = "";
      }
     /* database.ref('LetsChat/'+dbName1+'/'+dbName2).on('value').then( function(snapshot) {
        snapshot.forEach(function(childSnapshot){
          var txt = childSnapshot.val().Text;
          console.log(txt);
        }).error(e =>{
          console.log(e)
        });
   
     });*/
      
      /*function gotData(data){
        var cont = {};
        var cont = data.val();
        var keys = Object.keys(cont);
        
        for(var i=0; i<keys.length; i++){
          var k = keys[i];
          var txt = cont[k].Text;
          console.log(txt);
        }
      }*/
       
     }
     /* function testing(){
       window.toWhom = document.getElementById('test').value;
       console.log(window.toWhom);
     }*/

     
   </script>


 <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
  <!--<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>-->
  <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCs95pOO2eAgLtep3v7eaTrJJm1X1RXJ3U",
    authDomain: "chat-app-9abe7.firebaseapp.com",
    databaseURL: "https://chat-app-9abe7.firebaseio.com",
    projectId: "chat-app-9abe7",
    storageBucket: "chat-app-9abe7.appspot.com",
    messagingSenderId: "625053413425",
    appId: "1:625053413425:web:bb022f1979ae03e4066510",
    measurementId: "G-GC9QP143PT"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
  // make auth and firestore references
    const auth = firebase.auth();
    const db = firebase.firestore();

    const database =firebase.database();
    
    // update firestore settings
    //db.settings({ timestampsInSnapshots: true });

  
     
     /*).then( function(snapshot) {
        snapshot.forEach(function(childSnapshot){
          var txt = childSnapshot.val().Text;
          console.log(txt);
        });
   
     });*/

</script>
 
  
  <!-- Compiled and minified JavaScript -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>


  <script>
  
    $(document).ready(function(){
      $('.sidenav').sidenav();  //to show the nav bar when window is resized.
      $('#forgotLink').click(function(e){
        e.preventDefault();
        $('#modal-login').modal({
          dismissible: true
        });
        $('#modal-resetPassword').modal('open');
      }); 
      $('#userText') .keyup(function(e){
         if(document.getElementById('userText').value.trim().length >0){
            $('#send').attr('disabled', false);
            $("#send").css("cursor","pointer");
         }
         else{
           $('#send').attr('disabled', true);
           $("#send").css("cursor","context-menu");
         }
      });
      
      $("#send").click(function(){
         $('#right').animate({
           scrollTop: $('#right').get(0).scrollHeight
         }, 200);
        });

    });
  </script> 

  <script>
  


//window.toWhom="raviganeshmbhat999@gmail.com";
  

       // listen for auth status changes
auth.onAuthStateChanged(user => {
  console.log("state change");
  window.userIs=user;
    if (user) { //authorised user, but not confirmed the email
    db.collection('users').doc(user.uid).get().then(doc => {
        document.getElementById('userInformation1').innerHTML = doc.data().bio;
        document.getElementById('userInformation2').innerHTML = user.email;
        });
    
         selectValues={};
            storageRef.child('/Images/'+window.userIs.email+'/').listAll().then(function(result){
        result.prefixes.forEach(function(imageRef){
          //console.log(imageRef.name);
          selectValues[imageRef.name] = imageRef.name;
         });

    $.each(selectValues, function(key, value) {
     if(key != window.userIs.email){ 
     $('#categoryList1')
          .append($('<option>', { value : key })
          .text(value));
          $('select').formSelect();
     }
     });

      });   
    console.log(user);
       setupUI(user); 
  
      
    } else {
        setupUI();
    }

    

  });


// signup
const signupForm = document.querySelector('#signup-form');
signupForm.addEventListener('submit', (e) => {
  e.preventDefault();
  
  // get user info
  const email = signupForm['signup-email'].value;
  const password = signupForm['signup-password'].value;
  

  // sign up the user
  auth.createUserWithEmailAndPassword(email, password).then(cred => {
    return db.collection('users').doc(cred.user.uid).set({
        bio: signupForm['signup-bio'].value,
        email : email
      });
    }).then(() => {
    // close the signup modal & reset form
    const modal = document.querySelector('#modal-signup');
    M.Modal.getInstance(modal).close();
    signupForm.reset();
    signupForm.querySelector('.error').innerHTML = '';
    location.reload();
  }).catch(err => {
    signupForm.querySelector('.error').innerHTML = err.message;
  });
  
});

// login
const loginForm = document.querySelector('#login-form');
loginForm.addEventListener('submit', (e) => {
  e.preventDefault();
  
  // get user info
  const email = loginForm['login-email'].value;
  console.log(email);
  const password = loginForm['login-password'].value;

  // log the user in
  auth.signInWithEmailAndPassword(email, password).then((cred) => {
    console.log(cred.user);
    // close the signup modal & reset form
    const modal = document.querySelector('#modal-login');
    M.Modal.getInstance(modal).close();
    loginForm.reset();
    loginForm.querySelector('.error').innerHTML = '';
  }).catch(err => {
    loginForm.querySelector('.error').innerHTML = err.message;
  });

});

// PASSWORD RESET 
const resetPassForm = document.querySelector('#reset-password');
resetPassForm.addEventListener('submit', (e) => {
  e.preventDefault();
  
  // get user info
  var auth = firebase.auth();
  var user = firebase.auth().currentUser;
  var emailAddress = resetPassForm['login-email'].value;

  auth.sendPasswordResetEmail(emailAddress).then(function() {
    // Email sent.
      alert("Password reset email is sent to "+emailAddress);
    const modal = document.querySelector('#modal-resetPassword');
     M.Modal.getInstance(modal).close();
     resetPassForm.reset();
  }).catch(function(error) {
      // An error happened.
      alert("Error in sending the password reset email to "+emailAddress);
  });
});

</script>

  <script>

  function showChat(from, chat, time){
    //console.log(time);
    var li = document.createElement('div');
    var timediv = document.createElement('div');
    if(from == window.userIs.email){
      li.setAttribute("style", "font-size:70%;width:70%;padding-left:10px;margin-bottom:15px;margin-left:auto;margin-right:10%;background:#F7DC6F;margin-right:10px;border-radius:5px;");
    }
    else{
      li.setAttribute("style", "font-size:70%;width:70%;padding-left:10px;margin-bottom:15px;margin-left:5%;margin-right:auto;background:white;margin-right:10px;border-radius:5px;");
    }
    timediv.setAttribute("style", "padding-left:80%;font-size:10px;");
    timediv.textContent = time;
    li.textContent = chat;
    li.appendChild(timediv);
    document.querySelector('#showChat').appendChild(li);
    $("#right").scrollTop($("#right").prop('scrollHeight'));
  }
  function callShowChat(n1, n2){
    var dbName1 = n1;
    var dbName2 = n2;
     database.ref('LetsChat/'+dbName1+'/'+dbName2).on('value', snap =>{
       console.log(snap.val());
       document.querySelector("#showChat").innerHTML ="";
       snap.forEach(function(childSnapshot){
          var txt = childSnapshot.val().Text;
          var time = childSnapshot.val().Time;
          showChat(childSnapshot.val().From, txt, time);
          //console.log(txt);
        });
     });
  }
  function reply_click(id){
    document.getElementById("boxGameDiv").style.display ="block";
    for(var i=1;i<10;i++){
        document.getElementById(i.toString()).value='';
        document.getElementById(i.toString()).disabled = false;
      }

    db1 = id.substring(0, id.indexOf('@'));
    db2 = id.substring(id.indexOf('@')+1,id.indexOf('$'));
    if(db1 == window.userIs.email.replace(/[^a-zA-Z0-9]/g, "")){
        document.getElementById('whoseTurn').innerHTML = "Turn : You";
    }
    else{
        document.getElementById('whoseTurn').innerHTML = "Turn : Another Player";
    }
    window.toWhom = id.substring(id.indexOf('$')+1,id.indexOf('#'));
    document.getElementById("rEmail").innerHTML = id.substring(id.indexOf('#')+1,);
    console.log(window.toWhom);
    callShowChat(db1,db2);
    callShowBox(db1,db2);

  }
  var storageRef = firebase.storage().ref();
      // DOM elements
const loggedOutLinks = document.querySelectorAll('.logged-out');
const loggedInLinks = document.querySelectorAll('.logged-in');
const accountDetails = document.querySelector('.account-details');


const setupUI = (user) => {
    if (user) {
      console.log(user.email)
        // account info
        db.collection('users').doc(user.uid).get().then(doc => {
          window.userName = doc.data().bio;
          const html = `
            <div style="color:darkblue;">${doc.data().bio}</div>
            <div style="color:darkblue;">${user.email}</div>
          `;
          accountDetails.innerHTML = html;
          document.querySelector('.name').innerHTML = doc.data().bio;
          document.querySelector('.email').innerHTML = user.email;
        });
        // toggle user UI elements
        loggedInLinks.forEach(item => item.style.display = 'block');
        loggedOutLinks.forEach(item => item.style.display = 'none');

        firebase.firestore().collection('users').get().then((querySnapshot) => {
      const tempDoc = querySnapshot.docs.map((doc) => {
        if(doc.data().bio != window.userName){
          var emailSender = window.userIs.email.replace(/[^a-zA-Z0-9]/g, "");
          var emailReceiver = doc.data().email.replace(/[^a-zA-Z0-9]/g, "");

           var compare =  emailSender.localeCompare(emailReceiver);
          //window.toWhom = emailReceiver;
          if(compare == -1){
            n1 = emailSender;
            n2 = emailSender+'-'+emailReceiver;
         }
          else{
            n1 = emailReceiver;
            n2 = emailReceiver+'-'+emailSender;
         }
         console.log(n1,n2);
           var li = document.createElement('div');
           var uname = document.createElement('div');
           var email = document.createElement('div');
           //var newMsg = document.createElement('span');
           li.setAttribute("style","height:50px;border:4px solid #45B39D;border-radius:5px;padding-left:10px;margin-right:5px;cursor:pointer;margin-bottom:5px;");
           li.setAttribute("id",n1+"@"+n2+"$"+emailReceiver+"#"+doc.data().bio);
           li.setAttribute("class","usersNames");
           li.setAttribute("onMouseOver","this.style.background='#E8F8F5'");
           li.setAttribute("onMouseOut","this.style.background='#ffffff'");
           li.setAttribute("onclick","reply_click(this.id);");
           //newMsg.setAttribute("class", "new badge");
           //newMsg.setAttribute("id",n2);
           //newMsg.textContent = 4;
           email.setAttribute("style","font-size:50%;");
           uname.textContent = doc.data().bio;
           email.textContent =doc.data().email;
           li.appendChild(uname);
           li.appendChild(email);
           //li.appendChild(newMsg);
           document.querySelector("#friendList").appendChild(li);
        }
        
      });
      //console.log(tempDoc)
    });

      } else {
      // clear account info
    accountDetails.innerHTML = '';
    // toggle user elements
    loggedInLinks.forEach(item => item.style.display = 'none');
    loggedOutLinks.forEach(item => item.style.display = 'block');
  }
};

// setup materialize components
document.addEventListener('DOMContentLoaded', function() {

    var modals = document.querySelectorAll('.modal');
    M.Modal.init(modals);
  
    var items = document.querySelectorAll('.collapsible');
    M.Collapsible.init(items);
  
  });

</script>

<script>
    function logouts(){
      document.querySelector("#friendList").innerHTML = "";
      for(var i=1;i<10;i++){
        document.getElementById(i.toString()).value='';
      }
      document.getElementById('whoseTurn').innerHTML = "Turn : "
     auth.signOut();
        
  }
</script>

</body>
</html>